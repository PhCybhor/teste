<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Cybhor Tech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --navy: #01257D; --electric: #00FFFF; }
        body { background: #010d2e; color: white; font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .msg-cliente { background: var(--electric); color: var(--navy); align-self: flex-end; border-radius: 12px 12px 0 12px; }
        .msg-admin { background: rgba(255,255,255,0.05); align-self: flex-start; border-radius: 0 12px 12px 12px; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-8">Olá, <span id="user-display" class="text-electric">...</span></h1>

        <div class="fixed bottom-6 right-6 w-80 md:w-96 glass rounded-3xl overflow-hidden flex flex-col shadow-2xl">
            <div class="p-4 bg-electric/10 border-b border-white/10 font-bold text-xs uppercase tracking-widest text-electric">Suporte em Tempo Real</div>
            <div id="chat-box" class="h-80 overflow-y-auto p-4 flex flex-col gap-3 text-xs"></div>
            <form id="chat-form" class="p-3 border-t border-white/10 flex gap-2">
                <input type="text" id="chat-input" placeholder="Digite sua dúvida..." class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-2 outline-none focus:border-electric transition">
                <button class="bg-electric text-navy px-4 rounded-xl font-bold">↑</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
const firebaseConfig = {
    apiKey: "AIzaSyB_4aAZBxQbdAH5BsWnIk9-5-zSr0hwHc4",
    authDomain: "cybhor-b650a.firebaseapp.com",
    databaseURL: "https://cybhor-b650a-default-rtdb.firebaseio.com",
    projectId: "cybhor-b650a",
    storageBucket: "cybhor-b650a.firebasestorage.app",
    messagingSenderId: "737331307662",
    appId: "1:737331307662:web:ebe1ec62c2d7a819c615df",
    measurementId: "G-NVWX7SRPS6"
  };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        const userId = localStorage.getItem('userId');
        const userEmail = localStorage.getItem('userEmail');

        if(!userId) window.location.href = "login.html";
        document.getElementById('user-display').innerText = userEmail;

        const msgRef = ref(db, `mensagens/${userId}`);

        // Enviar
        document.getElementById('chat-form').onsubmit = (e) => {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            if(!input.value.trim()) return;

            push(msgRef, {
                texto: input.value,
                tipo: 'cliente',
                hora: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });

            update(ref(db, `users/${userId}`), { status: 'pendente' });
            input.value = "";
        };

        // Receber
        onValue(msgRef, (snap) => {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            snap.forEach(m => {
                const data = m.val();
                const div = document.createElement('div');
                div.className = data.tipo === 'cliente' ? 'msg-cliente p-3 max-w-[85%]' : 'msg-admin p-3 max-w-[85%]';
                div.innerHTML = `<p class="text-[9px] opacity-40 mb-1">${data.hora}</p><p>${data.texto}</p>`;
                box.appendChild(div);
            });
            box.scrollTop = box.scrollHeight;
        });
    </script>
</body>
</html>